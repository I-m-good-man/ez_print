(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-article"],{"527b":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;return e("TMPage",{scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"tm-sandbox-article__body"},[e("article",{directives:[{name:"hotkey",rawName:"v-hotkey.stop",value:{u:t.goToLastVisitedArticlesList},expression:"{ 'u': goToLastVisitedArticlesList }",modifiers:{stop:!0}}],ref:"article",staticClass:"tm-sandbox-article__content tm-sandbox-article__content_inner"},[t.article&&t.article.id?[e("TMArticleSnippet",{staticClass:"tm-sandbox-article__snippet",attrs:{article:t.article,"full-article":!0,tag:"h1"}}),t._v(" "),t.translationData?e("div",{staticClass:"tm-sandbox-article__origin"},[e("a",{staticClass:"tm-sandbox-article__origin-link",attrs:{href:t.translationData.originalUrl,target:"_blank"}},[t._v("\n              "+t._s(t.msg("ARTICLE_ORIGIN_TITLE"))+"\n              "),e("span",{staticClass:"tm-sandbox-article__origin-value"},[t._v("\n                "+t._s(t.translationData.originalAuthorName)+"\n              ")])])]):t._e(),t._v(" "),t.article.textHtml?e("TMArticleBody",{ref:"articleBody",attrs:{article:t.article}}):e("TMPlaceholder",{attrs:{type:"articleBody"}}),t._v(" "),e("div",{staticClass:"tm-article-body__tags"},[t.article.tags&&t.article.tags.length?e("TMTagsList",{staticClass:"tm-article-body__tags-links",attrs:{tags:t.article.tags,title:t.msg("ARTICLE_TAGS_TITLE")}}):t._e(),t._v(" "),t.article.hubs&&t.article.hubs.length?e("TMHubsList",{staticClass:"tm-article-body__tags-links",attrs:{hubs:t.article.hubs,title:t.msg("ARTICLE_HUBS_TITLE")}}):t._e()],1),t._v(" "),t.isLoggedIn?e("TMSandboxArticleFooter",{attrs:{"article-id":t.article.id,"article-lang":t.article.lang,"article-status":t.article.status},on:{update:t.checkAndUpdateArticleList}}):t._e()]:[e("TMPlaceholder",{attrs:{type:"article"}}),t._v(" "),e("TMPlaceholder",{attrs:{type:"articleBody"}})]],2)]),t._v(" "),e("div",{staticClass:"tm-sandbox-article__additional-blocks"},[t.isUserShowAds?e("TMAdfoxBanner",{staticClass:"tm-sandbox-article__banner",attrs:{"adfox-id":"164725660339535756","div-id":"articleBottomBanner",params:{pp:"h",ps:"fnps",p2:"hnyb"},variant:"leaderboard"}}):t._e(),t._v(" "),e("TMNotice",{attrs:{type:"neutral"}},[e("span",{domProps:{innerHTML:t._s(t.msg("SANDBOX_ADDITIONAL_WARNING"))}})])],1)]},proxy:!0},{key:"sidebar",fn:function(){return[t.isDesktop?e("TMLayoutSidebar",{attrs:{"show-ads":!0}},[e("TMBlock",{attrs:{tag:"aside",title:t.msg("TITLE_BLOCK_SANDBOX_ABOUT"),"title-tag":"h2"}},[e("div",{staticClass:"await-about-text",domProps:{innerHTML:t._s(t.msg("SANDBOX_SIDEBAR_ABOUT"))}})]),t._v(" "),e("TMBlock",{attrs:{tag:"aside",title:t.msg("TITLE_BLOCK_SANDBOX_ABOUT_MODERATION"),"title-tag":"h2"}},[e("div",{staticClass:"moderation-text",domProps:{innerHTML:t._s(t.msg("SANDBOX_MODERATION_BLOCK_TEXT_CONTENT",{careerHost:t.$options.CAREER_HOST,qnaHost:t.$options.QNA_HOST}))}})])],1):t._e()]},proxy:!0}])})},i=[],r=s("2f62"),n=s("116c"),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tm-ad-banner__container"},[t.adIsShown?e("a",{staticClass:"tm-ad-banner__title",attrs:{href:t.advertisingLink,target:"_blank"}},[t._v("\n    "+t._s(t.msg("NAV_ADVERTISING"))+"\n  ")]):t._e(),t._v(" "),e("div",{key:t.uniqueDivId,ref:"adBanner",staticClass:"tm-ad-banner",class:t.bem("tm-ad-banner",{variant:t.variant}),attrs:{id:t.uniqueDivId}})])},l=[],c=s("20a8"),d=s("522c"),u=s.n(d),g=s("2bf7");const h=["su","mo","tu","we","th","fr","sa"];let m=!1;function _(){const t=Object(g["d"])(Object(g["b"])());return t?t.path:""}function b(t,e){const s=e?e.randomVal:100,a=e?e.returnCode:"101";try{let e=localStorage.getItem(t);return null===e&&(e=1+Math.floor(Math.random()*s),localStorage.setItem(t,e)),String(e)}catch(i){return a}}function p(){return String(1+Math.floor(100*Math.random()))}function f(t,e,s){const a=new Date,i=a.getHours(),r=u()(i,2,"0"),n=h[a.getDay()];return window.googletag&&window.googletag.apiReady?(window.googletag.cmd.push(()=>{m||window.googletag.pubads().collapseEmptyDivs(),window.googletag.pubads().setTargeting("roxot-group-id",b("roxot-gid",{randomVal:1e4,returnCode:"10001"})).setTargeting("roxot-sector-id",b("roxot-sid")).setTargeting("roxot-deep",b("roxot-deep")).setTargeting("roxot-event-group-id",p()).setTargeting("roxot-event",p()).setTargeting("roxot-event-deep",p()).setTargeting("roxot-minutes",(new Date).getUTCMinutes().toString()).setTargeting("roxot-hours",(new Date).getUTCHours().toString()).setTargeting("roxot-day",(new Date).getUTCDay().toString()).setTargeting("roxot-lang",s).setTargeting("aa",t?"yes":"no").setTargeting("chr",r).setTargeting("cwd",n).setTargeting("dev","0").setTargeting("path",_()).setTargeting("user",e?"registered":"guest"),window.googletag.enableServices()}),m=!0,null):null}function T(t){const{flows:e,hubs:s}=t,a=e?e.map(t=>"f_"+t.alias):[],i=s?s.map(t=>"h_"+t.alias):[];return[...a,...i]}function O(t,e,{article:s,isLoggedIn:a,lang:i}){return!s||"object"===typeof s&&!s.id?Promise.resolve(null):(window.googletag.cmd.push(()=>{window.googletag.pubads().clearTargeting().setTargeting("cat",T(s)).setTargeting("pagetype",t).setTargeting("posttype",s.postType).setTargeting("postid",s.id.toString())}),f(e,a,i))}function v(t,e){const s=[];return t.params.hubName&&e&&(s.push("h_"+e.alias),e.flow&&e.flow.alias&&s.push("h_"+e.flow.alias)),t.params.flowName&&s.push("f_"+t.params.flowName),s}function A(t,e,{route:s,hub:a,isLoggedIn:i,lang:r}){return window.googletag.cmd.push(()=>{window.googletag.pubads().clearTargeting().setTargeting("pagetype",t);const e=v(s,a);e.length&&window.googletag.pubads().setTargeting("cats",e)}),f(e,i,r)}function S(t){switch(t){case"post":case"post_comments":return O;default:return A}}function w(t,e,s){let a="default";t.matched.forEach(t=>{t.meta&&t.meta.pageType&&(a=t.meta.pageType)});const i=S(a);return i(a,e,s)}var y=s("63af");function E(t){return null===t||Object(y["c"])(t.adUnit)&&Object(y["a"])(t.size)}const I={required:!0,validator:E};var B=s("cee5");function L(t,e){if(!e)return n["a"].notifyException("Define SizeMapping for "+t.getAdUnitPath()),t;const s=e.reduce((t,[e,s])=>t.addSize(e,s),window.googletag.sizeMapping());return t.defineSizeMapping(s.build()),t}function M(t,e){if(!e)return t;const s=Object.keys(e);return s.forEach(s=>{t.setTargeting(s,e[s])}),t}function x(t){return t.addService(window.googletag.pubads()),t}function D(t,e){return window.googletag&&window.googletag.apiReady?new Promise(s=>{window.googletag.cmd.push(()=>{const a=window.googletag.defineSlot(t.adUnit,t.size,e);L(a,t.mapping),M(a,t.targeting),x(a),s(a)})}):Promise.resolve(null)}s("8877");var R={name:"TMAdBanner",props:{adCodes:I,divId:{type:String,default:Object(c["a"])("adbanner")},variant:{type:String,required:!0}},data(){return{adIsShown:!1,observer:null,uniqueDivId:Object(c["a"])(this.divId),slot:null,init:!1}},computed:{...Object(r["c"])("articlesList",["getArticleById"]),...Object(r["c"])("hubs",["getHubByAlias"]),...Object(r["c"])("i18n",["msg"]),...Object(r["c"])("me",["isLoggedIn"]),...Object(r["e"])("adblock",["hasAcceptableAdsFilter"]),...Object(r["e"])("i18n",["fl","hl"]),articleId(){return this.$route.params.id},hubAlias(){return this.$route.params.hubName},hub(){return this.hubAlias&&this.getHubByAlias(this.hubAlias)},article(){return this.articleId&&this.getArticleById(this.articleId)},advertisingLink(){return`https://company.habr.com/${this.hl}/advertising/`}},activated(){this.init||(this.slot||this.defineSlot(),this.observer||this.initiObserver())},deactivated(){this.destroySlot()},mounted(){this.init=!0,this.defineSlot(),this.initiObserver()},beforeDestroy(){this.destroySlot()},methods:{bem:B["a"],initiObserver(){if(window.MutationObserver){const t=this.$refs.adBanner,e={childList:!0,subtree:!0},s=()=>{this.adIsShown=this.$refs.adBanner&&this.$refs.adBanner.firstElementChild&&this.$refs.adBanner.firstElementChild.childElementCount>0};this.observer=new MutationObserver(s),this.observer.observe(t,e)}else this.adIsShown=!0},destroySlot(){this.init=!1,this.observer&&(this.observer.disconnect(),this.observer=null,this.adIsShown=!1),window.googletag&&window.googletag.apiReady&&(window.googletag.cmd.push(()=>{window.googletag.destroySlots([this.slot])}),this.slot=null)},defineSlot(){window.googletag&&window.googletag.apiReady&&Boolean(this.adCodes)?D(this.adCodes,this.uniqueDivId).then(t=>{this.slot=t;const e={article:this.article,isLoggedIn:this.isLoggedIn,hub:this.hub,route:this.$route,lang:"en"===this.fl&&"en"===this.hl?"en":"ru"};w(this.$route,this.hasAcceptableAdsFilter,e),window.googletag.cmd.push(()=>{window.googletag.display(t)})}):setTimeout(()=>this.defineSlot(),2e3)}}},j=R,N=(s("cd69"),s("2877")),C=Object(N["a"])(j,o,l,!1,null,null,null),k=C.exports,F=s("2c95"),P=s("fe04"),U=s("19d1"),$=s("ecc3"),H=s("0272"),X=s("e4d1"),V=s("ff3c"),q=s("5188"),z=s("baf7"),G=s("485d"),J=s("a324"),K=s("6c10"),W=s("0e97"),Q=s("c70c");const Y={en:"en_US",ru:"ru_RU"};var Z={components:{TMHubsList:$["a"],TMTagsList:G["a"],TMAdfoxBanner:k,TMArticleBody:F["a"],TMArticleSnippet:P["a"],TMBlock:U["a"],TMLayoutSidebar:H["a"],TMNotice:X["a"],TMPage:V["a"],TMPlaceholder:q["a"],TMSandboxArticleFooter:z["a"]},asyncData({store:t,route:e}){return t.dispatch("sandbox/loadArticle",{route:e})},CAREER_HOST:K["a"],QNA_HOST:K["f"],computed:{...Object(r["e"])("me",["user"]),...Object(r["e"])("sandbox",["lastVisitedRoute"]),...Object(r["c"])("me",["isLoggedIn"]),...Object(r["c"])("i18n",["langOptions"]),...Object(r["c"])("sandbox",["getArticleById"]),...Object(r["c"])("ssr",["error"]),...Object(r["c"])("global",["isMobile","isDesktop"]),articleId(){return this.$route.params.id},article(){return this.getArticleById(this.articleId)},translationData(){if(this.article.postLabels&&this.article.postLabels.length){const t=this.article.postLabels.find(t=>"translation"===t.type);return t&&t.data}return null},isUserShowAds(){return!this.user||this.user&&!this.user.hideAds},adriverPixels(){const{metadata:t}=this.article;return t&&"undefined"!==typeof t.adriverPixels?t.adriverPixels:[]},analytics(){const{metadata:t}=this.article;return t&&"undefined"!==typeof t.analytics?t.analytics:{}},isFlEnglish(){return"en"===this.langOptions.fl}},metaInfo(){const{article:t,articleId:e}=this;if(!t||!t.metadata)return{};const{metadata:s,timePublished:a}=t,{metaDescription:i,shareImageUrl:r,shareImageWidth:n,shareImageHeight:o,vkShareImageUrl:l,schemaJsonLd:c}=s;let d=t.titleHtml;return t.isCorporative&&this.companyInfo&&(d+=" / "+this.msg("ARTICLE_COMPANY_BLOG",{companyName:this.companyInfo.titleHtml})),{title:d,meta:[...Object(J["f"])(t.titleHtml),...Object(J["d"])(i),...Object(J["e"])(r),Object(J["g"])(l),...Object(J["a"])({id:e,date:a}),{property:"og:type",content:"article",vmid:"og:type"},{property:"og:locale",content:Y[this.article.lang],vmid:"og:locale"},{property:"og:image:width",content:n,vmid:"og:image:width"},{property:"og:image:height",content:o,vmid:"og:image:height"},{name:"keywords",content:t.tags.map(t=>t.titleHtml).join(", ")}].filter(Boolean),script:[{type:"application/ld+json",innerHTML:c,vmid:"ldjson-schema"}],__dangerouslyDisableSanitizers:["script"],__dangerouslyDisableSanitizersByTagID:{"ldjson-schema":["innerHTML"]}}},mounted(){this.dataPromise.then(()=>{if(this.article){this.logAdriverPixel();const{fullPath:t}=this.$route;Object(Q["a"])(t)}}).catch(t=>n["a"].notifyException(t))},methods:{...Object(r["b"])("sandbox",["updateArticlesList"]),checkAndUpdateArticleList(){this.lastVisitedRoute.name&&this.updateArticlesList({route:this.lastVisitedRoute,id:this.articleId})},getUrlForTag(t){return{name:"SEARCH_QUERY_RESULTS",query:{target_type:"posts",order:"relevance",q:`[${t}]`}}},logAdriverPixel(){this.adriverPixels&&this.adriverPixels.length&&this.adriverPixels.forEach(t=>{const e=new Image;e.src=t})},goToLastVisitedArticlesList(){const t=Object(W["a"])(this.langOptions),e=this.lastVisitedRoute.name?this.lastVisitedRoute:t;this.$router.push(e)}}},tt=Z,et=(s("6747"),Object(N["a"])(tt,a,i,!1,null,null,null));e["default"]=et.exports},"58d4":function(t,e,s){},6747:function(t,e,s){"use strict";s("58d4")},"901a":function(t,e,s){},"93c8":function(t,e,s){},b126:function(t,e,s){"use strict";s("93c8")},baf7:function(t,e,s){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tm-sandbox-article-footer"},[t.isReasonsFormShown?t._e():e("div",{staticClass:"tm-sandbox-article-footer__buttons"},[t.user.availableInvitesCount>0&&t.sanboxArticlePage?e("TMButtonBase",{staticClass:"tm-sandbox-article-footer__button tm-sandbox-article-footer__button_accept",attrs:{"style-size":"small","style-type":"solid"},on:{click:function(e){return t.sendAuthorInvite(t.articleId)}}},[t._v("\n      "+t._s(t.msg("SANDBOX_INVITE_BUTTON_LABEL"))+"\n    ")]):t._e(),t._v(" "),t.showModerationControls?["sbModerationPending"===t.articleStatus?[e("TMButtonBase",{staticClass:"tm-sandbox-article-footer__button tm-sandbox-article-footer__button_approve",attrs:{"style-size":"small","style-type":"transparent"},on:{click:function(e){return t.publishToSandbox(t.articleId)}}},[t._v("\n          "+t._s(t.msg("SANDBOX_PUBLISH_BUTTON_LABEL"))+"\n        ")]),t._v(" "),e("TMButtonBase",{staticClass:"tm-sandbox-article-footer__button tm-sandbox-article-footer__button_rework",attrs:{"is-loading":t.reasonLoaders.rework,"style-size":"small","style-type":"transparent"},on:{click:function(e){return t.showReasonsForm({formId:"rework"})}}},[t._v("\n          "+t._s(t.msg("SANDBOX_REWORK_BUTTON_LABEL"))+"\n        ")])]:t._e(),t._v(" "),e("TMButtonBase",{staticClass:"tm-sandbox-article-footer__button tm-sandbox-article-footer__button_reject",attrs:{"is-loading":t.reasonLoaders.reject,"style-size":"small","style-type":"transparent"},on:{click:function(e){return t.showReasonsForm({formId:"reject"})}}},[t._v("\n        "+t._s(t.msg("SANDBOX_REJECT_BUTTON_LABEL"))+"\n      ")])]:t._e()],2),t._v(" "),t.isReasonsFormShown?e("div",{staticClass:"tm-sandbox-article-footer__form-wrapper"},[e("div",{staticClass:"tm-sandbox-article-footer__form-title"},[t._v("\n      "+t._s(t.formTitle)+"\n    ")]),t._v(" "),e("TMSvgIcon",{staticClass:"tm-sandbox-article-footer__close-button",attrs:{id:"close"},on:{click:t.closeForm}}),t._v(" "),e("TMFormBuilder",{key:t.targetFormAction+"_form",staticClass:"tm-sandbox-article-footer__form",attrs:{disabled:t.isSubmitLoading,fields:t.fields,"initial-data":t.initialData,lang:t.langOptions.hl,"submit-label":t.msg("SUBMIT_FORM_ACTION"),"use-test-id":t.useTestIds,"validate-on-blur":""},on:{submit:t.proceedForm,"update:data":t.onDataUpdate}})],1):t._e()])},i=[],r=s("2f62"),n=s("884d"),o=s("0578"),l=s("4a90"),c=s("c8a4"),d={components:{TMButtonBase:n["a"],TMFormBuilder:o["a"],TMSvgIcon:l["a"]},props:{articleId:{type:String,required:!0},articleStatus:{type:String,required:!0},articleLang:{type:String,required:!0}},data(){return{fields:[],initialData:{reason:"",message:""},isDataLoading:!0,isSubmitLoading:!1,isReasonsFormShown:!1,targetFormAction:null,reasons:null,reasonLoaders:{rework:!1,reject:!1}}},computed:{...Object(r["e"])("me",["user"]),...Object(r["c"])("me",["isSuperAdmin","isModerator"]),...Object(r["c"])("i18n",["langOptions"]),useTestIds(){return!1},showModerationControls(){return this.isSuperAdmin||this.isModerator},sanboxArticlePage(){return"ARTICLE_SANDBOX"===this.$route.name},formTitle(){return"rework"===this.targetFormAction?this.msg("SANDBOX_REWORK_FORM_TITLE"):this.msg("SANDBOX_REJECT_FORM_TITLE")},isReworkFormAction(){return"rework"===this.targetFormAction},reasonOptions(){return this.reasons?this.reasons.map(t=>({name:t.titleHtml,value:t.alias})):[]}},methods:{publishToSandbox(t){const e=window.confirm(this.msg("SANDBOX_PUBLISH_CONFIRM_MESSAGE"));return!!e&&Object(c["e"])(t).then(()=>{this.$toast.info(this.msg("SANDBOX_PUBLISHED_MESSAGE")),this.$emit("update")}).catch(t=>this.$toast.error(t.message))},sendAuthorInvite(t){const e=window.confirm(this.msg("SANDBOX_INVITE_CONFIRM_MESSAGE"));return!!e&&Object(c["g"])(t).then(t=>{this.$emit("update"),this.$router.push({name:"ARTICLE",params:{id:t.post,hl:this.langOptions.hl}}),this.$toast.info(this.msg("SANDBOX_MODERATE_FORM_INVITE_SEND_MESSAGE"))}).catch(t=>this.$toast.error(t.message))},showReasonsForm({formId:t}){const e="rework"===t?c["b"]:c["a"];this.reasonLoaders[t]=!0,e(this.langOptions.hl).then(({reasons:e})=>{this.isReasonsFormShown=!0,this.targetFormAction=t,this.reasons=e,this.fields=this.composeForm(this.reasonOptions)}).finally(()=>{this.reasonLoaders[t]=!1})},closeForm(){this.isReasonsFormShown=!1,this.initialData={reason:"",message:""}},onDataUpdate(t){const e=this.reasons.find(e=>e.alias===t.reason).noteHtml;this.initialData={...t,message:e}},composeForm(t){return[{className:"tm-select",label:this.msg("SANDBOX_MODERATE_FORM_REASON_LABEL"),description:"",name:"reason",type:"BaseSelect",validation:{required:!0},options:[{name:this.msg("SANDBOX_MODERATE_REASON_SELECT_LABEL"),value:""},...t]},{className:"tm-textarea",label:this.msg("SANDBOX_MODERATE_FORM_MESSAGE_LABEL"),description:"",name:"message",type:"BaseTextarea",validation:{required:!1}}]},proceedForm(t){this.isSubmitLoading=!0;const e=this.isReworkFormAction?c["h"]:c["f"];return e(this.articleId,{reason:t.reason,note:t.message}).then(()=>{const t=this.isReworkFormAction?this.msg("SANDBOX_MODERATE_FORM_REASON_REWORK_MESSAGE"):this.msg("SANDBOX_MODERATE_FORM_REASON_REJECT_MESSAGE");this.isSubmitLoading=!1,this.isReasonsFormShown=!1,this.$toast.info(t),this.initialData={reason:"",message:""},this.$emit("update")}).catch(t=>{const e=t.additional&&t.additional[0];"SANDBOX_POST_WAS_MODERATED"!==e&&"SANDBOX_POST_ALREADY_INVITED"!==e||this.$emit("update"),this.isSubmitLoading=!1,this.$toast.error(t.message)})}}},u=d,g=(s("b126"),s("2877")),h=Object(g["a"])(u,a,i,!1,null,null,null);e["a"]=h.exports},c8a4:function(t,e,s){"use strict";s.d(e,"f",(function(){return r})),s.d(e,"h",(function(){return n})),s.d(e,"g",(function(){return o})),s.d(e,"d",(function(){return l})),s.d(e,"e",(function(){return c})),s.d(e,"c",(function(){return d})),s.d(e,"a",(function(){return u})),s.d(e,"b",(function(){return g}));var a=s("2105"),i=s("4dcc");function r(t,e){return Object(a["c"])(Object(i["a"])(`sandbox/posts/${t}/reject`,"v2"),e)}function n(t,e){return Object(a["c"])(Object(i["a"])(`sandbox/posts/${t}/rework`,"v2"),e)}function o(t){return Object(a["c"])(Object(i["a"])(`sandbox/posts/${t}/send_invite`,"v2"))}function l(t,e){const s=e?"sandbox/save/"+e:"sandbox/save";return Object(a["c"])(Object(i["a"])(s,"v2"),t)}function c(t){return Object(a["c"])(Object(i["a"])(`sandbox/posts/${t}/approve`,"v2"))}function d(t){return Object(a["b"])(Object(i["a"])("sandbox/post-data/"+t,"v2"))}function u(t){return Object(a["b"])(Object(i["a"])("sandbox/refs/reject_reasons","v2"),{hl:t})}function g(t){return Object(a["b"])(Object(i["a"])("sandbox/refs/rework_reasons","v2"),{hl:t})}},cd69:function(t,e,s){"use strict";s("901a")}}]);
//# sourceMappingURL=page-article.f7c9bd30.js.map